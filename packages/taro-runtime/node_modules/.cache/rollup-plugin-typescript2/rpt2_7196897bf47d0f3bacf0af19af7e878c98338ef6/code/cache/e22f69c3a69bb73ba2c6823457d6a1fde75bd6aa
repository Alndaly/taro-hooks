{"code":"import { isFunction, isArray, ensure } from '@tarojs/shared';\r\nimport container from '../container';\r\nimport SERVICE_IDENTIFIER from '../constants/identifiers';\r\nimport { Current } from '../current';\r\nimport { injectPageInstance, safeExecute } from './common';\r\nimport { isBrowser } from '../env';\r\nfunction createVue3Page(h, id) {\r\n    return function (component) {\r\n        var _a;\r\n        const inject = {\r\n            props: {\r\n                tid: String\r\n            },\r\n            created() {\r\n                injectPageInstance(this, id);\r\n                // vue3 组件 created 时机比小程序页面 onShow 慢，因此在 created 后再手动触发一次 onShow。\r\n                this.$nextTick(() => {\r\n                    safeExecute(id, 'onShow');\r\n                });\r\n            }\r\n        };\r\n        if (isArray(component.mixins)) {\r\n            const mixins = component.mixins;\r\n            const idx = mixins.length - 1;\r\n            if (!((_a = mixins[idx].props) === null || _a === void 0 ? void 0 : _a.tid)) {\r\n                // mixins 里还没注入过，直接推入数组\r\n                component.mixins.push(inject);\r\n            }\r\n            else {\r\n                // mixins 里已经注入过，代替前者\r\n                component.mixins[idx] = inject;\r\n            }\r\n        }\r\n        else {\r\n            component.mixins = [inject];\r\n        }\r\n        return h(isBrowser ? 'div' : 'root', {\r\n            key: id,\r\n            id,\r\n            class: isBrowser ? 'taro_page' : ''\r\n        }, [\r\n            h(Object.assign({}, component), {\r\n                tid: id\r\n            })\r\n        ]);\r\n    };\r\n}\r\nfunction setReconciler() {\r\n    const hooks = container.get(SERVICE_IDENTIFIER.Hooks);\r\n    const getLifecycle = function (instance, lifecycle) {\r\n        return instance.$options[lifecycle];\r\n    };\r\n    const modifyMpEvent = function (event) {\r\n        event.type = event.type.replace(/-/g, '');\r\n    };\r\n    hooks.getLifecycle = getLifecycle;\r\n    hooks.modifyMpEvent = modifyMpEvent;\r\n    if (process.env.TARO_ENV === 'h5') {\r\n        hooks.createPullDownComponent = (component, path, h) => {\r\n            const inject = {\r\n                props: {\r\n                    tid: String\r\n                },\r\n                created() {\r\n                    injectPageInstance(this, path);\r\n                }\r\n            };\r\n            component.mixins = isArray(component.mixins)\r\n                ? component.mixins.push(inject)\r\n                : [inject];\r\n            return {\r\n                render() {\r\n                    return h('taro-pull-to-refresh', {\r\n                        class: 'hydrated'\r\n                    }, [h(component, this.$slots.default)]);\r\n                }\r\n            };\r\n        };\r\n        hooks.getDOMNode = (el) => {\r\n            return el.$el;\r\n        };\r\n    }\r\n}\r\nexport function createVue3App(app, h, config) {\r\n    let pages = [];\r\n    let appInstance;\r\n    ensure(!isFunction(app._component), '入口组件不支持使用函数式组件');\r\n    setReconciler();\r\n    app._component.render = function () {\r\n        return pages.slice();\r\n    };\r\n    if (!isBrowser) {\r\n        appInstance = app.mount('#app');\r\n    }\r\n    const appConfig = Object.create({\r\n        mount(component, id, cb) {\r\n            const page = createVue3Page(h, id)(component);\r\n            pages.push(page);\r\n            this.updateAppInstance(cb);\r\n        },\r\n        unmount(id, cb) {\r\n            pages = pages.filter(page => page.key !== id);\r\n            this.updateAppInstance(cb);\r\n        },\r\n        updateAppInstance(cb) {\r\n            appInstance.$forceUpdate();\r\n            appInstance.$nextTick(cb);\r\n        }\r\n    }, {\r\n        config: {\r\n            writable: true,\r\n            enumerable: true,\r\n            configurable: true,\r\n            value: config\r\n        },\r\n        onLaunch: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                var _a;\r\n                Current.router = Object.assign({ params: options === null || options === void 0 ? void 0 : options.query }, options);\r\n                if (isBrowser) {\r\n                    appInstance = app.mount('#app');\r\n                }\r\n                const onLaunch = (_a = appInstance === null || appInstance === void 0 ? void 0 : appInstance.$options) === null || _a === void 0 ? void 0 : _a.onLaunch;\r\n                isFunction(onLaunch) && onLaunch.call(appInstance, options);\r\n            }\r\n        },\r\n        onShow: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                var _a;\r\n                Current.router = Object.assign({ params: options === null || options === void 0 ? void 0 : options.query }, options);\r\n                const onShow = (_a = appInstance === null || appInstance === void 0 ? void 0 : appInstance.$options) === null || _a === void 0 ? void 0 : _a.onShow;\r\n                isFunction(onShow) && onShow.call(appInstance, options);\r\n            }\r\n        },\r\n        onHide: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                var _a;\r\n                const onHide = (_a = appInstance === null || appInstance === void 0 ? void 0 : appInstance.$options) === null || _a === void 0 ? void 0 : _a.onHide;\r\n                isFunction(onHide) && onHide.call(appInstance, options);\r\n            }\r\n        }\r\n    });\r\n    Current.app = appConfig;\r\n    return Current.app;\r\n}\r\n//# sourceMappingURL=vue3.js.map","references":["/Users/inoccent/github/taro-hooks/node_modules/@tarojs/shared/dist/index.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/container/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/constants/identifiers.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/current.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dsl/common.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/env.ts","/Users/inoccent/github/taro-hooks/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dom/element.ts","/Users/inoccent/github/taro-hooks/node_modules/@tarojs/taro/types/index.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/interface/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dsl/instance.ts"],"map":"{\"version\":3,\"file\":\"vue3.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/dsl/vue3.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/inoccent/github/taro-hooks/packages/taro-runtime/node_modules/.cache/rollup-plugin-typescript2/placeholder/dsl/vue3.d.ts","writeByteOrderMark":false,"text":"import type { App, h as createElement } from '@vue/runtime-core';\r\nimport type { TaroElement } from '../dom/element';\r\nimport type { AppConfig as Config } from '@tarojs/taro';\r\nimport type { AppInstance } from './instance';\r\nexport declare function createVue3App(app: App<TaroElement>, h: typeof createElement, config: Config): AppInstance;\r\n"}}
