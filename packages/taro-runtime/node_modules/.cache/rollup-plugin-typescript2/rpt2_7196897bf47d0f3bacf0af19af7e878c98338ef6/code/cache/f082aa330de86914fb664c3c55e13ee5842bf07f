{"code":"import { isFunction, noop, ensure, isBoolean } from '@tarojs/shared';\r\nimport container from '../container';\r\nimport SERVICE_IDENTIFIER from '../constants/identifiers';\r\nimport { injectPageInstance } from './common';\r\nimport { Current } from '../current';\r\nimport { document } from '../bom/document';\r\nimport { isBrowser } from '../env';\r\nexport function connectVuePage(Vue, id) {\r\n    return (component) => {\r\n        const injectedPage = Vue.extend({\r\n            props: {\r\n                tid: String\r\n            },\r\n            mixins: [component, {\r\n                    created() {\r\n                        injectPageInstance(this, id);\r\n                    }\r\n                }]\r\n        });\r\n        const options = {\r\n            render(h) {\r\n                return h(isBrowser ? 'div' : 'root', {\r\n                    attrs: {\r\n                        id,\r\n                        class: isBrowser ? 'taro_page' : ''\r\n                    }\r\n                }, [\r\n                    h(injectedPage, { props: { tid: id } })\r\n                ]);\r\n            }\r\n        };\r\n        return options;\r\n    };\r\n}\r\nfunction setReconciler() {\r\n    const hooks = container.get(SERVICE_IDENTIFIER.Hooks);\r\n    const onRemoveAttribute = function (dom, qualifiedName) {\r\n        // 处理原因: https://github.com/NervJS/taro/pull/5990\r\n        const props = dom.props;\r\n        if (!props.hasOwnProperty(qualifiedName) || isBoolean(props[qualifiedName])) {\r\n            dom.setAttribute(qualifiedName, false);\r\n            return true;\r\n        }\r\n    };\r\n    const getLifecycle = function (instance, lifecycle) {\r\n        return instance.$options[lifecycle];\r\n    };\r\n    hooks.onRemoveAttribute = onRemoveAttribute;\r\n    hooks.getLifecycle = getLifecycle;\r\n    if (process.env.TARO_ENV === 'h5') {\r\n        hooks.createPullDownComponent = (el, path, vue) => {\r\n            const injectedPage = vue.extend({\r\n                props: {\r\n                    tid: String\r\n                },\r\n                mixins: [el, {\r\n                        created() {\r\n                            injectPageInstance(this, path);\r\n                        }\r\n                    }]\r\n            });\r\n            const options = {\r\n                name: 'PullToRefresh',\r\n                render(h) {\r\n                    return h('taro-pull-to-refresh', {\r\n                        class: ['hydrated']\r\n                    }, [h(injectedPage, this.$slots.default)]);\r\n                }\r\n            };\r\n            return options;\r\n        };\r\n        hooks.getDOMNode = (el) => {\r\n            return el.$el;\r\n        };\r\n    }\r\n}\r\nlet Vue;\r\nexport function createVueApp(App, vue, config) {\r\n    Vue = vue;\r\n    ensure(!!Vue, '构建 Vue 项目请把 process.env.FRAMEWORK 设置为 \\'vue\\'');\r\n    setReconciler();\r\n    Vue.config.getTagNamespace = noop;\r\n    const elements = [];\r\n    const pages = [];\r\n    let appInstance;\r\n    const wrapper = new Vue({\r\n        render(h) {\r\n            while (pages.length > 0) {\r\n                const page = pages.pop();\r\n                elements.push(page(h));\r\n            }\r\n            return h(App, { ref: 'app' }, elements.slice());\r\n        },\r\n        methods: {\r\n            mount(component, id, cb) {\r\n                pages.push((h) => h(component, { key: id }));\r\n                this.updateSync(cb);\r\n            },\r\n            updateSync(cb) {\r\n                this._update(this._render(), false);\r\n                this.$children.forEach((child) => child._update(child._render(), false));\r\n                cb();\r\n            },\r\n            unmount(id, cb) {\r\n                for (let i = 0; i < elements.length; i++) {\r\n                    const element = elements[i];\r\n                    if (element.key === id) {\r\n                        elements.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                this.updateSync(cb);\r\n            }\r\n        }\r\n    });\r\n    if (!isBrowser) {\r\n        wrapper.$mount(document.getElementById('app'));\r\n    }\r\n    const app = Object.create({\r\n        mount(component, id, cb) {\r\n            const page = connectVuePage(Vue, id)(component);\r\n            wrapper.mount(page, id, cb);\r\n        },\r\n        unmount(id, cb) {\r\n            wrapper.unmount(id, cb);\r\n        }\r\n    }, {\r\n        config: {\r\n            writable: true,\r\n            enumerable: true,\r\n            configurable: true,\r\n            value: config\r\n        },\r\n        onLaunch: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                Current.router = Object.assign({ params: options === null || options === void 0 ? void 0 : options.query }, options);\r\n                if (isBrowser) {\r\n                    // 由于 H5 路由初始化的时候会清除 app 下的 dom 元素，所以需要在路由初始化后再执行 render\r\n                    wrapper.$mount(document.getElementById('app'));\r\n                }\r\n                appInstance = wrapper.$refs.app;\r\n                if (appInstance != null && isFunction(appInstance.$options.onLaunch)) {\r\n                    appInstance.$options.onLaunch.call(appInstance, options);\r\n                }\r\n            }\r\n        },\r\n        onShow: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                Current.router = Object.assign({ params: options === null || options === void 0 ? void 0 : options.query }, options);\r\n                if (appInstance != null && isFunction(appInstance.$options.onShow)) {\r\n                    appInstance.$options.onShow.call(appInstance, options);\r\n                }\r\n            }\r\n        },\r\n        onHide: {\r\n            writable: true,\r\n            enumerable: true,\r\n            value(options) {\r\n                if (appInstance != null && isFunction(appInstance.$options.onHide)) {\r\n                    appInstance.$options.onHide.call(appInstance, options);\r\n                }\r\n            }\r\n        }\r\n    });\r\n    Current.app = app;\r\n    return Current.app;\r\n}\r\n//# sourceMappingURL=vue.js.map","references":["/Users/inoccent/github/taro-hooks/node_modules/@tarojs/shared/dist/index.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/container/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/constants/identifiers.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dsl/common.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/current.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/bom/document.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/env.ts","/Users/inoccent/github/taro-hooks/node_modules/vue/types/index.d.ts","/Users/inoccent/github/taro-hooks/node_modules/vue/types/index.d.ts","/Users/inoccent/github/taro-hooks/node_modules/@tarojs/taro/types/index.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dsl/instance.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/interface/index.ts"],"map":"{\"version\":3,\"file\":\"vue.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/dsl/vue.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/inoccent/github/taro-hooks/packages/taro-runtime/node_modules/.cache/rollup-plugin-typescript2/placeholder/dsl/vue.d.ts","writeByteOrderMark":false,"text":"import type VueCtor from 'vue';\r\nimport type { ComponentOptions, VueConstructor } from 'vue';\r\nimport type { AppConfig } from '@tarojs/taro';\r\nimport type { AppInstance } from './instance';\r\nexport declare type V = typeof VueCtor;\r\nexport declare function connectVuePage(Vue: VueConstructor, id: string): (component: ComponentOptions<VueCtor>) => ComponentOptions<VueCtor, import(\"vue/types/options\").DefaultData<VueCtor>, import(\"vue/types/options\").DefaultMethods<VueCtor>, import(\"vue/types/options\").DefaultComputed, import(\"vue/types/options\").PropsDefinition<import(\"vue/types/options\").DefaultProps>, import(\"vue/types/options\").DefaultProps>;\r\nexport declare function createVueApp(App: ComponentOptions<VueCtor>, vue: V, config: AppConfig): AppInstance;\r\n"}}
