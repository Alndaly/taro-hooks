{"code":"import { EMPTY_OBJ } from '@tarojs/shared';\r\nimport container from '../container';\r\nimport { ElementNames } from '../interface';\r\nimport { isParentBinded } from '../utils';\r\nimport SERVICE_IDENTIFIER from '../constants/identifiers';\r\nimport { CONFIRM, CURRENT_TARGET, INPUT, KEY_CODE, TARGET, TIME_STAMP, TYPE, TOUCHMOVE } from '../constants';\r\nconst hooks = container.get(SERVICE_IDENTIFIER.Hooks);\r\nconst getElement = container.get(SERVICE_IDENTIFIER.TaroElementFactory);\r\nconst document = getElement(ElementNames.Document)();\r\n// Taro 事件对象。以 Web 标准的事件对象为基础，加入小程序事件对象中携带的部分信息，并模拟实现事件冒泡。\r\nexport class TaroEvent {\r\n    constructor(type, opts, event) {\r\n        this._stop = false;\r\n        this._end = false;\r\n        this.defaultPrevented = false;\r\n        // timestamp can either be hi-res ( relative to page load) or low-res (relative to UNIX epoch)\r\n        // here use hi-res timestamp\r\n        this.timeStamp = Date.now();\r\n        this.type = type.toLowerCase();\r\n        this.mpEvent = event;\r\n        this.bubbles = Boolean(opts && opts.bubbles);\r\n        this.cancelable = Boolean(opts && opts.cancelable);\r\n    }\r\n    stopPropagation() {\r\n        this._stop = true;\r\n    }\r\n    stopImmediatePropagation() {\r\n        this._end = this._stop = true;\r\n    }\r\n    preventDefault() {\r\n        this.defaultPrevented = true;\r\n    }\r\n    get target() {\r\n        var _a, _b, _c;\r\n        const element = document.getElementById((_a = this.mpEvent) === null || _a === void 0 ? void 0 : _a.target.id);\r\n        return Object.assign(Object.assign(Object.assign({}, (_b = this.mpEvent) === null || _b === void 0 ? void 0 : _b.target), (_c = this.mpEvent) === null || _c === void 0 ? void 0 : _c.detail), { dataset: element !== null ? element.dataset : EMPTY_OBJ });\r\n    }\r\n    get currentTarget() {\r\n        var _a, _b, _c;\r\n        const element = document.getElementById((_a = this.mpEvent) === null || _a === void 0 ? void 0 : _a.currentTarget.id);\r\n        if (element === null) {\r\n            return this.target;\r\n        }\r\n        return Object.assign(Object.assign(Object.assign({}, (_b = this.mpEvent) === null || _b === void 0 ? void 0 : _b.currentTarget), (_c = this.mpEvent) === null || _c === void 0 ? void 0 : _c.detail), { dataset: element.dataset });\r\n    }\r\n}\r\nexport function createEvent(event, node) {\r\n    if (typeof event === 'string') {\r\n        // For Vue3 using document.createEvent\r\n        return new TaroEvent(event, { bubbles: true, cancelable: true });\r\n    }\r\n    const domEv = new TaroEvent(event.type, { bubbles: true, cancelable: true }, event);\r\n    for (const key in event) {\r\n        if (key === CURRENT_TARGET || key === TARGET || key === TYPE || key === TIME_STAMP) {\r\n            continue;\r\n        }\r\n        else {\r\n            domEv[key] = event[key];\r\n        }\r\n    }\r\n    if (domEv.type === CONFIRM && (node === null || node === void 0 ? void 0 : node.nodeName) === INPUT) {\r\n        // eslint-disable-next-line dot-notation\r\n        domEv[KEY_CODE] = 13;\r\n    }\r\n    return domEv;\r\n}\r\nconst eventsBatch = {};\r\n// 小程序的事件代理回调函数\r\nexport function eventHandler(event) {\r\n    var _a;\r\n    (_a = hooks.modifyMpEvent) === null || _a === void 0 ? void 0 : _a.call(hooks, event);\r\n    if (event.currentTarget == null) {\r\n        event.currentTarget = event.target;\r\n    }\r\n    const node = document.getElementById(event.currentTarget.id);\r\n    if (node) {\r\n        const dispatch = () => {\r\n            var _a;\r\n            const e = createEvent(event, node);\r\n            (_a = hooks.modifyTaroEvent) === null || _a === void 0 ? void 0 : _a.call(hooks, e, node);\r\n            node.dispatchEvent(e);\r\n        };\r\n        if (typeof hooks.batchedEventUpdates === 'function') {\r\n            const type = event.type;\r\n            if (!hooks.isBubbleEvents(type) ||\r\n                !isParentBinded(node, type) ||\r\n                (type === TOUCHMOVE && !!node.props.catchMove)) {\r\n                // 最上层组件统一 batchUpdate\r\n                hooks.batchedEventUpdates(() => {\r\n                    if (eventsBatch[type]) {\r\n                        eventsBatch[type].forEach(fn => fn());\r\n                        delete eventsBatch[type];\r\n                    }\r\n                    dispatch();\r\n                });\r\n            }\r\n            else {\r\n                // 如果上层组件也有绑定同类型的组件，委托给上层组件调用事件回调\r\n                (eventsBatch[type] || (eventsBatch[type] = [])).push(dispatch);\r\n            }\r\n        }\r\n        else {\r\n            dispatch();\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=event.js.map","references":["/Users/inoccent/github/taro-hooks/node_modules/@tarojs/shared/dist/index.d.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/container/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/interface/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/utils/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/constants/identifiers.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/constants/index.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/dom/element.ts","/Users/inoccent/github/taro-hooks/packages/taro-runtime/src/interface/index.ts"],"map":"{\"version\":3,\"file\":\"event.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/dom/event.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/inoccent/github/taro-hooks/packages/taro-runtime/node_modules/.cache/rollup-plugin-typescript2/placeholder/dom/event.d.ts","writeByteOrderMark":false,"text":"import type { TaroElement } from './element';\r\nimport type { EventOptions, MpEvent } from '../interface';\r\nexport declare class TaroEvent {\r\n    type: string;\r\n    bubbles: boolean;\r\n    cancelable: boolean;\r\n    _stop: boolean;\r\n    _end: boolean;\r\n    defaultPrevented: boolean;\r\n    timeStamp: number;\r\n    mpEvent: MpEvent | undefined;\r\n    constructor(type: string, opts: EventOptions, event?: MpEvent);\r\n    stopPropagation(): void;\r\n    stopImmediatePropagation(): void;\r\n    preventDefault(): void;\r\n    get target(): {\r\n        dataset: any;\r\n        id?: string | undefined;\r\n    };\r\n    get currentTarget(): {\r\n        dataset: any;\r\n        id?: string | undefined;\r\n    };\r\n}\r\nexport declare function createEvent(event: MpEvent | string, node?: TaroElement): TaroEvent;\r\nexport declare function eventHandler(event: MpEvent): void;\r\n"}}
